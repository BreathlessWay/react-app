webpackJsonp([5],{221:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function r(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),c=n.n(i),s=n(5),l=(n.n(s),n(29)),p=n.n(l),h=n(257),u=(n.n(h),function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}()),m=function(t){function e(t){o(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={topicInfo:Object(s.Map)({title:"",tab:"dev",content:""}),topicError:Object(s.Map)({title:"",content:""}),time:null},n.handleTitleChange=n.handleTitleChange.bind(n),n.handleContentChange=n.handleContentChange.bind(n),n.handleTabChange=n.handleTabChange.bind(n),n.handleTopicSubmit=n.handleTopicSubmit.bind(n),n.handleSubmitNewTopic=n.handleSubmitNewTopic.bind(n),n.handleEditTopic=n.handleEditTopic.bind(n),n}return r(e,t),u(e,[{key:"componentDidMount",value:function(){var t=this.props.match.params.id?[{path:"/",name:"\u9996\u9875"},{path:"",name:"\u7f16\u8f91"}]:[{path:"/",name:"\u9996\u9875"},{path:"",name:"\u53d1\u8d34"}];this.props.setBreadcrumb(t),this.props.match.params.id&&this.getDetail()}},{key:"getDetail",value:function(){var t=this,e=this.props.entry.getIn(["userInfo","accesstoken"]);p.a.get("/topic/"+this.props.match.params.id,{params:{accesstoken:e,mdrender:!1}}).then(function(e){var n=Object(s.fromJS)(e.data.data);t.setState({topicInfo:n})}).catch(function(e){var n=e.response.data;t.props.handleDialog({type:"danger",message:n?n.error_msg:"\u8bf7\u6c42\u5f02\u5e38"})})}},{key:"handleTitleChange",value:function(t){var e=t.target.value;return 0===e.length?void this.setState(function(t){return{topicError:t.topicError.set("title","\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a"),topicInfo:t.topicInfo.set("title",e.trim())}}):e.length>100?void this.setState(function(t){return{topicError:t.topicError.set("title","\u6807\u9898\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57")}}):void this.setState(function(t){return{topicError:t.topicError.set("title",""),topicInfo:t.topicInfo.set("title",e.trim())}})}},{key:"handleContentChange",value:function(t){var e=t.target.value;return 0===e.length?void this.setState(function(t){return{topicError:t.topicError.set("content","\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a"),topicInfo:t.topicInfo.set("content",e.trim())}}):e.length>500?void this.setState(function(t){return{topicError:t.topicError.set("content","\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7500\u4e2a\u5b57")}}):void this.setState(function(t){return{topicError:t.topicError.set("content",""),topicInfo:t.topicInfo.set("content",e.trim())}})}},{key:"handleTabChange",value:function(t){var e=t.target.value;this.setState(function(t){return{topicInfo:t.topicInfo.set("tab",e)}})}},{key:"handleTopicSubmit",value:function(){var t=this.state.topicInfo.get("title"),e=this.state.topicInfo.get("content"),n=this.state.topicInfo.get("tab"),o=this.props.entry.getIn(["userInfo","accesstoken"]);try{if(0===this.state.topicInfo.get("title").length)throw this.setState(function(t){return{topicError:t.topicError.set("title","\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a")}}),new Error("\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a");if(0===this.state.topicInfo.get("content").length)throw this.setState(function(t){return{topicError:t.topicError.set("content","\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a")}}),new Error("\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a");if(this.state.topicError.get("content").length>0)throw new Error("\u5185\u5bb9\u8fc7\u957f");if(this.state.topicError.get("title").length>0)throw new Error("\u6807\u9898\u8fc7\u957f")}catch(t){return}this.props.match.params.id?this.handleEditTopic({accesstoken:o,title:t,tab:n,content:e,topic_id:this.props.match.params.id}):this.handleSubmitNewTopic({accesstoken:o,title:t,tab:n,content:e})}},{key:"handleEditTopic",value:function(t){var e=this,n=t.accesstoken,o=t.title,a=t.tab,r=t.content,i=t.topic_id;p.a.post("/topics/update",{accesstoken:n,title:o,tab:a,content:r,topic_id:i}).then(function(t){t.data.success&&(e.setState({time:setTimeout(function(){e.props.history.replace("/")},1e3)}),e.props.handleDialog({type:"success",message:"\u7f16\u8f91\u6210\u529f"}))}).catch(function(t){var n=t.response.data;e.props.handleDialog({type:"danger",message:n?n.error_msg:"\u7f16\u8f91\u5931\u8d25"})})}},{key:"handleSubmitNewTopic",value:function(t){var e=this,n=t.accesstoken,o=t.title,a=t.tab,r=t.content;p.a.post("/topics",{accesstoken:n,title:o,tab:a,content:r}).then(function(t){t.data.success&&(e.setState({time:setTimeout(function(){e.props.history.replace("/")},1e3)}),e.props.handleDialog({type:"success",message:"\u53d1\u5e16\u6210\u529f"}))}).catch(function(t){var n=t.response.data;e.props.handleDialog({type:"danger",message:n?n.error_msg:"\u53d1\u5e16\u5931\u8d25"})})}},{key:"componentWillUnmount",value:function(){window.clearTimeout(this.state.time)}},{key:"render",value:function(){return c.a.createElement("article",{className:"container-fluid"},c.a.createElement("section",{className:"container topic-index"},c.a.createElement("form",{className:"pt-4 px-5 pb-2"},c.a.createElement("div",{className:"form-group row"},c.a.createElement("label",{htmlFor:"topicTitle",className:"col-sm-1 col-form-label"},"\u6807\u9898"),c.a.createElement("div",{className:"col-sm-11"},c.a.createElement("input",{type:"text",className:"form-control",id:"topicTitle",value:this.state.topicInfo.get("title"),onChange:this.handleTitleChange}),c.a.createElement("p",{className:"text-danger topic-index_error pt-1"},this.state.topicError.get("title")))),c.a.createElement("div",{className:"form-group row"},c.a.createElement("label",{htmlFor:"topicContent",className:"col-sm-1 col-form-label"},"\u5185\u5bb9"),c.a.createElement("div",{className:"col-sm-11"},c.a.createElement("textarea",{className:"form-control",id:"topicContent",rows:"10",value:this.state.topicInfo.get("content"),onChange:this.handleContentChange}),c.a.createElement("p",{className:"text-danger topic-index_error pt-1"},this.state.topicError.get("content")))),c.a.createElement("div",{className:"form-group row"},c.a.createElement("label",{htmlFor:"topicTab",className:"col-sm-1 col-form-label"},"\u5206\u7c7b"),c.a.createElement("div",{className:"col-sm-11"},c.a.createElement("select",{className:"form-control",id:"topicTab",value:this.state.topicInfo.get("tab"),onChange:this.handleTabChange},c.a.createElement("option",{value:"ask"},"\u95ee\u7b54"),c.a.createElement("option",{value:"share"},"\u5206\u4eab"),c.a.createElement("option",{value:"job"},"\u5de5\u4f5c"),c.a.createElement("option",{value:"dev"},"\u6d4b\u8bd5")),c.a.createElement("p",{className:"text-danger topic-index_error pt-1"},"\u5b98\u65b9\u8b66\u544a\uff1a\u8bf7\u52a1\u5fc5\u5c06\u4f60\u4eec\u7684\u6d4b\u8bd5\u5e16\u53d1\u5728 dev \u4e13\u533a\uff0c\u4ee5\u514d\u6c61\u67d3\u65e5\u5e38\u7684\u7248\u9762\uff0c\u5426\u5219\u4f1a\u8fdb\u884c\u5c01\u53f7\u4e00\u5468\u5904\u7406\u3002")))),c.a.createElement("footer",{className:"px-5 text-right pb-4"},c.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.props.history.goBack},"\u53d6\u6d88"),"\xa0\xa0\xa0\xa0",c.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleTopicSubmit},"\u63d0\u4ea4"))))}}]),e}(i.Component);e.default=m},257:function(t,e,n){var o=n(258);"string"===typeof o&&(o=[[t.i,o,""]]);var a={hmr:!1};a.transform=void 0;n(213)(o,a);o.locals&&(t.exports=o.locals)},258:function(t,e,n){e=t.exports=n(212)(!0),e.push([t.i,".topic-index{background:#fff}.topic-index .topic-index_error{font-size:12px}","",{version:3,sources:["/Users/zhujian/Desktop/react-app/src/pages/PostTopic/style.less"],names:[],mappings:"AAAA,aACE,eAAiB,CAClB,AACD,gCACE,cAAgB,CACjB",file:"style.less",sourcesContent:[".topic-index {\n  background: #fff;\n}\n.topic-index .topic-index_error {\n  font-size: 12px;\n}\n"],sourceRoot:""}])}});
//# sourceMappingURL=topic.0c1d91ee.chunk.js.map